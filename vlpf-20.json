{
  "variables": {
    "box_name": "vlpf-20",
    "aws_secret_key": "{{env `AWS_SECRET_KEY`}}",
    "aws_access_key": "{{env `AWS_ACCESS_KEY`}}"
  },
  "provisioners": [
    {
      "type": "file",
      "source": "ansible",
      "destination": "/tmp/ansible"
    },
    {
      "type": "shell",
      "script": "misc/provision"
    }
  ],
  "post-processors": [
    {
      "type": "vagrant",
      "output": "boxes/vlipco/{{ user `box_name` }}.box",
      "compression_level": 9
    }
  ],
  "builders": [
    {
      "type": "amazon-ebs",
      "ssh_username": "fedora",
      "access_key": "{{user `aws_access_key`}}",
      "ami_block_device_mappings": [
        {
          "volume_size": 15,
          "device_name": "/dev/sda1",
          "delete_on_termination": true
        }
      ],
      "ami_name": "{{ user `box_name` }}-{{timestamp}}",
      "instance_type": "m1.xlarge",
      "launch_block_device_mappings": [
        {
          "volume_size": 15,
          "device_name": "/dev/sda1",
          "delete_on_termination": true
        }
      ],
      "region": "us-east-1",
      "secret_key": "{{user `aws_secret_key`}}",
      "source_ami": "ami-1337187a"
    },
    {
      "vm_name": "{{ user `box_name` }}",
      "headless": true,
      "output_directory": ".tmp/{{ user `box_name` }}",
      "shutdown_command": "sudo systemctl poweroff",
      "source_path": "boxes/chef/fedora-20/box.ovf",
      "ssh_key_path": "misc/vagrant-insecure.pem",
      "ssh_username": "vagrant",
      "type": "virtualbox-ovf",
      "vboxmanage": [
        [
          "modifyvm",
          "{{.Name}}",
          "--memory",
          4096
        ],
        [
          "modifyvm",
          "{{.Name}}",
          "--cpus",
          2
        ]
      ]
    },
    {
      "type": "digitalocean",
      "snapshot_name": "{{ user `box_name` }}-{{timestamp}}",
      "size": "512mb",
      "region": "nyc2",
      "image": "fedora-20-x64",
      "droplet_name": "{{ user `box_name` }}-{{timestamp}}"
    }
  ]
}
