---
variables:
  box_name: vlipco-fedora-20

builders:

  - type: virtualbox-ovf
    source_path: boxes/chef/fedora-20/box.ovf
    vm_name: "{{ user `box_name` }}"
    ssh_username: vagrant
    output_directory: ".tmp/{{ user `box_name` }}"
    headless: True
    ssh_key_path: misc/vagrant-insecure.pem
    #ssh_wait_timeout: 1m
    shutdown_command: sudo systemctl poweroff
    vboxmanage:
      - ["modifyvm", "{{.Name}}", "--memory", 4096]
      - ["modifyvm", "{{.Name}}", "--cpus", 2]

  # DIGITALOCEAN_CLIENT_ID & DIGITALOCEAN_API_KEY env vars required
  - type: digitalocean
    droplet_name: "{{ user `box_name` }}-{{timestamp}}"
    region: nyc2
    size: 512mb
    image: fedora-20-x64
    snapshot_name: "{{ user `box_name` }}-{{timestamp}}"

provisioners:
  - type: file
    source: ansible
    destination: /tmp/ansible
  - type: shell
    script: misc/provision
post-processors:
  - type: vagrant
    compression_level: 9
    output: "boxes/vlipco/{{ user `box_name` }}.box"